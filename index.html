<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NHM Quoting Tool</title>

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <style>
    input[type="checkbox"] {
      appearance: none;
      width: 22px;
      height: 22px;
      border: 2px solid #27488f;
      border-radius: 4px;
      background-color: #fff;
      transition: all 0.2s ease;
      position: relative;
      cursor: pointer;
    }

    input[type="checkbox"]::before {
      content: "";
      position: absolute;
      width: 6px;
      height: 12px;
      border: solid #27488f;
      border-width: 0 2px 2px 0;
      top: 2px;
      left: 7px;
      transform: rotate(45deg);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    input[type="checkbox"]:checked {
      background-color: #f58020;
      border-color: #f58020;
    }

    input[type="checkbox"]:checked::before {
      opacity: 1;
    }

    label[for="supplyOnly"],
    label[for="vatExempt"] {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 16px 0;
      font-weight: 500;
      font-size: 0.95rem;
      color: #27488f;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="logo-container">
    <img src="nhm-logo.png" alt="Company Logo" class="logo" />
  </div>

  <h1>Quote Estimator</h1>

  <form>
    <h2>Customer Details</h2>
    <label for="customerName">Customer Name:
      <input type="text" id="customerName" placeholder="e.g. Jamie Baker" />
    </label>

    <label for="quoteNumber">Job/Quote Number:
      <input type="text" id="quoteNumber" placeholder="e.g. Q12345" />
    </label>

    <h2>Repair Details</h2>

    <label for="assetSelect">Asset Type:</label>
    <select id="assetSelect"></select>

    <div id="makeSection" style="display: none;">
      <label for="makeSelect">Make/Model:</label>
      <select id="makeSelect"></select>
    </div>

    <div id="repairSection" style="display: none;">
      <label for="repairSelect">Repair Type:</label>
      <select id="repairSelect"></select>
    </div>

    <div id="optionsSection" style="display: none;">
      <label for="supplyOnly">
        <input type="checkbox" id="supplyOnly" />
        Supply Only (no labour charge)
      </label>
      <label for="vatExempt">
        <input type="checkbox" id="vatExempt" />
        VAT Exempt (no VAT added to this quote)
      </label>
    </div>
  </form>

  <div class="quote-section">
    <div id="estimate"></div>
    <button id="downloadPDF">Download PDF</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const data = {
      "Mobile Hoist": {
        "Oxford Midi 180": {
          "Replacement Battery": {
            labour_hours: 0.5,
            material_cost: 85.0,
            part_number: "OXBATT180"
          },
          "Handset Replacement": {
            labour_hours: 0.75,
            material_cost: 65.0,
            part_number: "OXHAND180"
          }
        }
      }
    };

    let assetChoices, makeChoices, repairChoices;

    document.addEventListener("DOMContentLoaded", () => {
      const assetSelect = document.getElementById("assetSelect");
      const makeSelect = document.getElementById("makeSelect");
      const repairSelect = document.getElementById("repairSelect");

      const names = [
        "Terry Clarke", "Jayden Davis", "Ken McIntyre", "Phill Darkin",
        "Matthew Pons", "Ashley Henry", "Kelly Hart", "Andrea Oswald",
        "Jamie Baker", "Elliot Bowler-Lee", "Steve Cottee", "Elena McColl",
        "Paul McMullan", "Steven Webb"
      ];
      const randomName = names[Math.floor(Math.random() * names.length)];
      document.getElementById("customerName").placeholder = `e.g. ${randomName}`;
      document.getElementById("quoteNumber").placeholder = "e.g. Q12345";

      assetChoices = new Choices(assetSelect, {
        searchEnabled: true,
        placeholder: true,
        itemSelectText: "",
      });

      const assets = Object.keys(data).map(asset => ({ value: asset, label: asset }));
      assetChoices.setChoices(assets, 'value', 'label', true);

      assetSelect.addEventListener("change", () => {
        const selectedAsset = assetSelect.value;
        const makes = Object.keys(data[selectedAsset]);

        if (makeChoices) makeChoices.destroy();
        makeChoices = new Choices(makeSelect, {
          searchEnabled: true,
          placeholder: true,
          itemSelectText: "",
        });

        makeChoices.setChoices(makes.map(make => ({ value: make, label: make })), 'value', 'label', true);

        document.getElementById("makeSection").style.display = "block";
        document.getElementById("repairSection").style.display = "none";
        document.getElementById("optionsSection").style.display = "none";
        document.getElementById("estimate").innerHTML = "";
      });

      makeSelect.addEventListener("change", () => {
        const selectedAsset = assetSelect.value;
        const selectedMake = makeSelect.value;
        const repairs = Object.keys(data[selectedAsset][selectedMake]);

        if (repairChoices) repairChoices.destroy();
        repairChoices = new Choices(repairSelect, {
          searchEnabled: true,
          placeholder: true,
          itemSelectText: "",
        });

        repairChoices.setChoices(repairs.map(repair => ({ value: repair, label: repair })), 'value', 'label', true);

        document.getElementById("repairSection").style.display = "block";
        document.getElementById("optionsSection").style.display = "none";
        document.getElementById("estimate").innerHTML = "";
      });

      repairSelect.addEventListener("change", () => {
        document.getElementById("optionsSection").style.display = "block";
        showEstimate();
      });

      document.getElementById("supplyOnly").addEventListener("change", showEstimate);
      document.getElementById("vatExempt").addEventListener("change", showEstimate);
    });

    function showEstimate() {
      const asset = document.getElementById("assetSelect").value;
      const make = document.getElementById("makeSelect").value;
      const repair = document.getElementById("repairSelect").value;
      const customerName = document.getElementById("customerName").value;
      const quoteNumber = document.getElementById("quoteNumber").value;
      const supplyOnly = document.getElementById("supplyOnly").checked;
      const vatExempt = document.getElementById("vatExempt").checked;

      if (!asset || !make || !repair) return;

      const info = data[asset][make][repair];
      const labour = supplyOnly ? 0 : info.labour_hours * 45;
      const carriage = supplyOnly ? 15.95 : 0;
      const subtotal = labour + info.material_cost + carriage;
      const vat = vatExempt ? 0 : subtotal * 0.2;
      const total = subtotal + vat;

      document.getElementById("estimate").innerHTML = `
        <h3>Quote Summary</h3>
        <p><strong>Customer:</strong> ${customerName || "N/A"}</p>
        <p><strong>Quote #:</strong> ${quoteNumber || "N/A"}</p>
        <p><strong>Asset:</strong> ${asset}</p>
        <p><strong>Make:</strong> ${make}</p>
        <p><strong>Repair:</strong> ${repair} (Part #${info.part_number})</p>
        <p>Labour: ${supplyOnly ? "N/A (Supply Only)" : `£${labour.toFixed(2)}`}</p>
        <p>Materials: £${info.material_cost.toFixed(2)}</p>
        ${supplyOnly ? `<p>Carriage: £${carriage.toFixed(2)}</p>` : ""}
        <hr>
        <p><strong>Subtotal (excl. VAT):</strong> £${subtotal.toFixed(2)}</p>
        <p><strong>VAT (${vatExempt ? "Exempt" : "20%"}):</strong> £${vat.toFixed(2)}</p>
        <p><strong>Total (incl. VAT): £${total.toFixed(2)}</strong></p>
      `;
    }
  </script>
</body>
</html>
